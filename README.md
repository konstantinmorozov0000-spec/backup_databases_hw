# Домашнее задание
## Резервное копирование баз данных

---

## Задание 1. Резервное копирование

### 1.1. Восстановление данных в полном объёме за предыдущий день

Для восстановления базы данных целиком за предыдущий день подходит полное резервное копирование (Full Backup).

Суть метода:
- создаётся полная копия всей базы данных (обычно один раз в сутки);
- резервная копия содержит состояние базы на конкретный момент времени;
- при сбое база данных полностью восстанавливается из последнего бэкапа.

Преимущества:
- простота восстановления;
- минимальная потеря данных за предыдущий день.

Недостатки:
- большой объём резервных копий;
- длительное время выполнения резервного копирования.

---

### 1.2. Восстановление данных за час до предполагаемой поломки

Для восстановления данных за конкретный момент времени используется комбинированный подход:
- полное резервное копирование;
- инкрементное резервное копирование;
- журналы транзакций (WAL для PostgreSQL, binlog для MySQL).

Алгоритм восстановления:
1. восстановление последнего полного бэкапа;
2. применение инкрементных копий или логов;
3. остановка восстановления на нужном моменте времени.

Данный подход позволяет восстановить данные за час или даже за несколько минут до сбоя.

---

### 1.3*. Моментальное переключение на работающую базу данных

Да, такой кейс возможен.

Для этого используется репликация и механизм failover.
При отказе основной базы данных происходит переключение на реплику, содержащую актуальные данные.

Примеры решений:
- master–slave / primary–replica репликация;
- PostgreSQL Streaming Replication;
- MySQL Replication;
- инструменты автоматического переключения (Patroni, Pacemaker, Keepalived);
- облачные managed-сервисы.

---

## Задание 2. PostgreSQL

### 2.1. Пример резервного копирования и восстановления

Резервное копирование базы данных с помощью pg_dump:

    pg_dump -U postgres -F c -b -v -f backup.dump mydatabase

Описание параметров:
- -F c — кастомный формат архива;
- -b — включение бинарных данных;
- -v — подробный вывод.

Восстановление базы данных с помощью pg_restore:

    pg_restore -U postgres -d mydatabase -v backup.dump

---

### 2.1*. Автоматизация резервного копирования PostgreSQL

Процесс резервного копирования можно автоматизировать.

Для этого используются:
- cron;
- bash-скрипты;
- systemd timers;
- специализированные инструменты (pgBackRest, Barman).

Пример автоматического резервного копирования с помощью cron:

    0 2 * * * pg_dump -U postgres mydatabase > /backups/mydatabase_$(date +%F).sql

---

## Задание 3. MySQL

### 3.1. Инкрементное резервное копирование MySQL

В MySQL инкрементное резервное копирование реализуется с помощью binary logs (binlog).

Включение binlog в конфигурационном файле my.cnf:

    [mysqld]
    log_bin = mysql-bin
    server-id = 1

Создание полного резервного копирования:

    mysqldump -u root -p --all-databases --flush-logs --master-data=2 > full_backup.sql

Инкрементное резервное копирование с использованием binlog:

    mysqlbinlog mysql-bin.000001 > incremental_backup.sql

---

### 3.1*. Когда использование реплики лучше обычного резервного копирования

Использование реплики имеет преимущество в следующих случаях:
- требуется высокая доступность сервиса;
- недопустим простой базы данных;
- резервное копирование не должно нагружать основную БД;
- требуется быстрое переключение без ожидания восстановления из бэкапа;
- необходимо распределение нагрузки на чтение.

Важно отметить, что реплика не заменяет резервное копирование, а используется совместно с ним.

---

## Вывод

Надёжная стратегия резервного копирования включает:
- полные резервные копии;
- инкрементные копии и журналы транзакций;
- репликацию и механизмы отказоустойчивости.

Комбинация этих подходов обеспечивает сохранность, доступность и надёжность данных.
