ДОМАШНЕЕ ЗАДАНИЕ
РЕЗЕРВНОЕ КОПИРОВАНИЕ БАЗ ДАННЫХ

====================================================================

ЗАДАНИЕ 1. РЕЗЕРВНОЕ КОПИРОВАНИЕ

====================================================================

[ 1.1 ] ВОССТАНОВЛЕНИЕ ДАННЫХ В ПОЛНОМ ОБЪЁМЕ ЗА ПРЕДЫДУЩИЙ ДЕНЬ

В данном случае оптимальным решением является
ПОЛНОЕ РЕЗЕРВНОЕ КОПИРОВАНИЕ (FULL BACKUP).

СУТЬ МЕТОДА:
-> Создаётся полная копия всей базы данных (обычно 1 раз в сутки)
-> Хранится состояние БД на конец предыдущего дня
-> При сбое база полностью восстанавливается из этого бэкапа

ПРЕИМУЩЕСТВА:
[] Простота восстановления
[] Минимальная потеря данных
[*] Подходит для критичных финансовых данных

НЕДОСТАТКИ:
[] Большой размер резервных копий
[] Длительное время выполнения

[ 1.2 ] ВОССТАНОВЛЕНИЕ ДАННЫХ ЗА ЧАС ДО ПРЕДПОЛАГАЕМОЙ ПОЛОМКИ

Для восстановления данных за конкретный момент времени применяется
КОМБИНИРОВАННОЕ РЕЗЕРВНОЕ КОПИРОВАНИЕ.

ИСПОЛЬЗУЕМЫЕ МЕХАНИЗМЫ:
-> Полный бэкап (раз в сутки)
-> Инкрементные бэкапы (раз в час)
-> Журналы транзакций (WAL / binlog)

АЛГОРИТМ ВОССТАНОВЛЕНИЯ:

Восстановление последнего полного бэкапа

Применение инкрементных данных

Остановка восстановления на нужном времени

РЕЗУЛЬТАТ:
[] Восстановление данных за час (или минуты) до сбоя
[] Минимальная потеря информации

[ 1.3 * ] МОМЕНТАЛЬНОЕ ПЕРЕКЛЮЧЕНИЕ НА РАБОТАЮЩУЮ БАЗУ ДАННЫХ

ДА, ТАКОЙ КЕЙС ВОЗМОЖЕН.

Для этого используется
РЕПЛИКАЦИЯ И МЕХАНИЗМ FAILOVER.

ПРИНЦИП РАБОТЫ:
-> Основная база данных выходит из строя
-> Реплика содержит актуальную копию данных
-> Происходит автоматическое или ручное переключение

ПРИМЕРЫ РЕШЕНИЙ:
[] PostgreSQL Streaming Replication
[] MySQL Replication
[] Master-Slave / Primary-Replica
[] Patroni, Pacemaker, Keepalived
[*] Облачные managed-сервисы

ЗАДАНИЕ 2. POSTGRESQL

====================================================================

[ 2.1 ] ПРИМЕР РЕЗЕРВНОГО КОПИРОВАНИЯ И ВОССТАНОВЛЕНИЯ

РЕЗЕРВНОЕ КОПИРОВАНИЕ (pg_dump):

```

pg_dump -U postgres -F c -b -v -f backup.dump mydatabase

```

ОПИСАНИЕ КЛЮЧЕЙ:
-> -F c : кастомный формат архива
-> -b : бинарные данные
-> -v : подробный вывод

ВОССТАНОВЛЕНИЕ (pg_restore):

```

pg_restore -U postgres -d mydatabase -v backup.dump

```

[ 2.1 * ] АВТОМАТИЗАЦИЯ РЕЗЕРВНОГО КОПИРОВАНИЯ POSTGRESQL

АВТОМАТИЗАЦИЯ ВОЗМОЖНА.

ИСПОЛЬЗУЕМЫЕ ИНСТРУМЕНТЫ:
[] cron
[] bash-скрипты
[] systemd timers
[] pgBackRest, Barman

ПРИМЕР CRON-ЗАДАЧИ:

```

0 2 * * * pg_dump -U postgres mydatabase > /backups/mydatabase_$(date +%F).sql

```

ЗАДАНИЕ 3. MYSQL

====================================================================

[ 3.1 ] ИНКРЕМЕНТНОЕ РЕЗЕРВНОЕ КОПИРОВАНИЕ MYSQL

В MySQL инкрементное резервное копирование выполняется
С ПОМОЩЬЮ BINARY LOGS (BINLOG).

ВКЛЮЧЕНИЕ BINLOG (my.cnf):

```

[mysqld]
log_bin = mysql-bin
server-id = 1

```

ПОЛНЫЙ БЭКАП:

```

mysqldump -u root -p --all-databases --flush-logs --master-data=2 > full_backup.sql

```

ИНКРЕМЕНТНЫЙ БЭКАП:

```

mysqlbinlog mysql-bin.000001 > incremental_backup.sql

```

[ 3.1 * ] КОГДА РЕПЛИКА ЛУЧШЕ ОБЫЧНОГО БЭКАПА

РЕПЛИКА ИМЕЕТ ПРЕИМУЩЕСТВА, ЕСЛИ:
[] Требуется высокая доступность
[] Недопустим простой сервиса
[] Нужно снизить нагрузку на основную БД
[] Важно быстрое переключение без restore
[*] Требуется масштабирование чтения

ВАЖНО:
Реплика НЕ ЗАМЕНЯЕТ резервное копирование,
а используется ВМЕСТЕ С НИМ.

ИТОГОВЫЙ ВЫВОД

====================================================================

НАДЁЖНАЯ СТРАТЕГИЯ РЕЗЕРВНОГО КОПИРОВАНИЯ ВКЛЮЧАЕТ:
-> Полные резервные копии
-> Инкрементные копии и журналы транзакций
-> Репликацию и failover

Комбинирование этих подходов обеспечивает
СОХРАННОСТЬ, ДОСТУПНОСТЬ И НАДЁЖНОСТЬ ДАННЫХ.
